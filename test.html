<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>エリア色分けマップ</title>
  <style>#map { height: 600px; width: 100%; }</style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC4IGLPtG-Ql2wKO9VePaPFiRkJPZlhVa4"></script> 
  <!--API KEY:  AIzaSyC4IGLPtG-Ql2wKO9VePaPFiRkJPZlhVa4 -->
</head>
<body>
  <h2>エリア色分けマップ</h2>
  <div id="map"></div>
  <script>
    async function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        center: {lat: 35.68, lng: 139.76},
        zoom: 10,
      });

      // スプレッドシートのデータを取得
      const res = await fetch("https://script.google.com/macros/s/AKfycbxvlzZsYiN7aBO75Sb9tN-ZXFXSUq8pA54jo65hd3-nmd0RXGDpBs-LFJ5Gz3HDJzH8/exec");
      const rows = await res.json();
      const byId = Object.fromEntries(rows.map(r => [String(r.area_id), r]));

      // GeoJSONを読み込み
      map.data.loadGeoJson("map.geojson");

      // スタイル設定
      map.data.setStyle(feature => {
        const row = byId[String(feature.getId("name"))]; // GeoJSONのidとシートのarea_idを対応
        let color = "#ccc";
        if (row) {
          if (row.status === "1year") color = "green";
          else if (row.status === "Do") color = "blue";
          else if (row.status === "No") color = "gray";
        }
        return { fillColor: color, strokeColor: "#333", strokeWeight: 1, fillOpacity: 0.6 };
      });
    }
    window.onload = initMap;
  </script>
</body>
</html>